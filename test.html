<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ç«æŸ´äººå°æ±º</title>

<!-- ğŸ”” æ›æˆä½ çš„ icon æª”æ¡ˆ -->
<link rel="icon" href="images.jpg">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
}
body{
  display:flex;
  justify-content:center;
  align-items:center;
  background:#111;
  color:#fff;
  font-family:system-ui;
}
#app{
  width:360px;
  text-align:center;
}
canvas{
  background:#f5f5f5;
  border-radius:12px;
  margin:10px 0;
}
button,select{
  padding:8px 12px;
  border-radius:10px;
  border:none;
}
.menu,.end{
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:center;
}
#mobileControls{
  display:none;
  justify-content:space-between;
}
@media (orientation: landscape){
  #mobileControls{display:flex}
}
.key{
  border:1px solid #555;
  padding:2px 6px;
  border-radius:6px;
}
</style>
</head>

<body>
<div id="app">

<!-- ğŸ”¹ è¨­å®šé¸å–® -->
<div id="menu" class="menu">
  <h2>ç«æŸ´äººå°æ±º</h2>

  <label>
    <input type="radio" name="mode" value="cpu" checked> å–®äººï¼ˆæ‰“é›»è…¦ï¼‰
  </label>
  <label>
    <input type="radio" name="mode" value="pvp"> é›™äººå°æˆ°
  </label>

  <div id="difficultyBox">
    AI é›£åº¦ï¼š
    <select id="difficulty">
      <option value="easy">ç°¡å–®</option>
      <option value="normal" selected>æ™®é€š</option>
      <option value="hard">å›°é›£</option>
    </select>
  </div>

  <div>ç©å®¶1 <input id="n1" value="ç©å®¶1"> <input type="color" id="c1" value="#000000"></div>
  <div>ç©å®¶2 <input id="n2" value="ç©å®¶2"> <input type="color" id="c2" value="#ff0000"></div>

  <button onclick="start()">é–‹å§‹éŠæˆ²</button>
</div>

<canvas id="game" width="360" height="400" style="display:none"></canvas>

<!-- ğŸ“± æ‰‹æ©Ÿæ§åˆ¶ -->
<div id="mobileControls">
  <div>
    <button ontouchstart="m1L=1" ontouchend="m1L=0">â—€</button>
    <button ontouchstart="m1R=1" ontouchend="m1R=0">â–¶</button>
    <button ontouchstart="m1J=1" ontouchend="m1J=0">è·³</button>
    <button ontouchstart="m1P=1" ontouchend="m1P=0">ğŸ‘Š</button>
  </div>
  <div>
    <button ontouchstart="m2L=1" ontouchend="m2L=0">â—€</button>
    <button ontouchstart="m2R=1" ontouchend="m2R=0">â–¶</button>
    <button ontouchstart="m2J=1" ontouchend="m2J=0">è·³</button>
    <button ontouchstart="m2P=1" ontouchend="m2P=0">ğŸ‘Š</button>
  </div>
</div>

<div style="font-size:12px">
ğŸ’» P1 <span class="key">A</span><span class="key">D</span><span class="key">W</span><span class="key">F</span>
ï½œ P2 <span class="key">â†</span><span class="key">â†’</span><span class="key">â†‘</span><span class="key">/</span>
</div>

<!-- ğŸ çµæŸ -->
<div id="end" class="end" style="display:none">
  <h2 id="win"></h2>
  <button onclick="restart()">å†ä¾†ä¸€å ´</button>
  <button onclick="back()">å›è¨­å®š</button>
</div>

</div>

<script>
/* ================= åŸºæœ¬è¨­å®š ================= */
const c = game, ctx = c.getContext("2d");
const ground = 300, grav = 0.8;
let k = {}, over = false, gameMode = "cpu", aiLevel = "normal";
let m1L=0,m1R=0,m1J=0,m1P=0,m2L=0,m2R=0,m2J=0,m2P=0;

window.onkeydown=e=>k[e.key]=1;
window.onkeyup=e=>k[e.key]=0;

/* ================= éŸ³æ•ˆ ================= */
const AudioCtx = new (window.AudioContext||webkitAudioContext)();
function sound(f){
  const o=AudioCtx.createOscillator(),g=AudioCtx.createGain();
  o.connect(g); g.connect(AudioCtx.destination);
  o.frequency.value=f; g.gain.value=0.15;
  o.start(); o.stop(AudioCtx.currentTime+0.08);
}

/* ================= è§’è‰² ================= */
function fighter(x,name,color){
  return {x,y:ground,vy:0,hp:100,name,color,
    punch:false,onGround:true,dead:false,rot:0};
}
let p1,p2,effects=[];

/* ================= AI ================= */
const AI={
  easy:{retreat:20,attack:0.05,jump:0.003,react:0.6},
  normal:{retreat:30,attack:0.15,jump:0.008,react:1},
  hard:{retreat:40,attack:0.3,jump:0.015,react:1.3}
};

function cpuControl(cpu,player){
  const cfg=AI[aiLevel];
  let L=0,R=0,J=0,P=0;
  const d=player.x-cpu.x, a=Math.abs(d);
  if(Math.random()>cfg.react) return update(cpu,player,0,0,0,0);

  if(a<cfg.retreat){ d>0?L=1:R=1; }
  else if(a>60){ d>0?R=1:L=1; }
  else if(Math.random()<cfg.attack) P=1;
  if(Math.random()<cfg.jump && cpu.onGround) J=1;

  update(cpu,player,L,R,J,P);
}

/* ================= éŠæˆ²é‚è¼¯ ================= */
function update(p,e,L,R,J,P){
  if(p.dead) return;
  if(L)p.x-=3; if(R)p.x+=3;
  if(J&&p.onGround){p.vy=-12;p.onGround=false}
  p.vy+=grav; p.y+=p.vy;
  if(p.y>=ground){p.y=ground;p.vy=0;p.onGround=true}

  if(P&&!p.punch){
    p.punch=true; sound(180);
    if(Math.abs(p.x-e.x)<55&&!e.dead){
      e.hp=Math.max(0,e.hp-10);
      effects.push({x:e.x,y:e.y-40,r:5,l:10});
    }
    setTimeout(()=>p.punch=false,200);
  }
}

function drawF(p){
  ctx.save();
  ctx.translate(p.x,p.y-20);
  ctx.rotate(p.rot);
  ctx.strokeStyle=p.color; ctx.lineWidth=4;
  ctx.beginPath(); ctx.arc(0,-30,10,0,7); ctx.stroke();       // é ­
  ctx.beginPath(); ctx.moveTo(0,-20); ctx.lineTo(0,5); ctx.stroke(); // èº«
  ctx.beginPath(); ctx.moveTo(0,-10); ctx.lineTo(-20,-5); ctx.stroke(); // å·¦æ‰‹
  ctx.beginPath(); ctx.moveTo(0,-10); ctx.lineTo(20,-5); ctx.stroke();  // å³æ‰‹
  ctx.beginPath(); ctx.moveTo(0,5); ctx.lineTo(-10,25); ctx.stroke();   // å·¦è…³
  ctx.beginPath(
