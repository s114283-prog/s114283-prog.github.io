<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>火柴人對決</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    body{margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#111;color:#fff;font-family:system-ui;touch-action:none}
    canvas{background:#f5f5f5;border-radius:12px}
    .controls{display:flex;flex-wrap:wrap;justify-content:space-between;width:360px;margin-top:8px}
    .side{display:flex;gap:6px}
    button{font-size:14px;padding:10px 12px;border-radius:10px;border:none}
  </style>
</head>
<body>
<canvas id="game" width="360" height="400"></canvas>

<!-- PVP 手機控制 -->
<div class="controls">
  <div class="side">
    <button ontouchstart="keys.aL=true" ontouchend="keys.aL=false">◀</button>
    <button ontouchstart="keys.aR=true" ontouchend="keys.aR=false">▶</button>
    <button ontouchstart="keys.aJ=true" ontouchend="keys.aJ=false">跳</button>
    <button ontouchstart="keys.aP=true" ontouchend="keys.aP=false">拳</button>
  </div>
  <div class="side">
    <button ontouchstart="keys.bP=true" ontouchend="keys.bP=false">拳</button>
    <button ontouchstart="keys.bJ=true" ontouchend="keys.bJ=false">跳</button>
    <button ontouchstart="keys.bL=true" ontouchend="keys.bL=false">◀</button>
    <button ontouchstart="keys.bR=true" ontouchend="keys.bR=false">▶</button>
  </div>
</div>

<script>
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
const groundY=300,gravity=0.8;let gameOver=false;
const keys={};let effects=[];

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(f,d){const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.frequency.value=f;o.connect(g);g.connect(audioCtx.destination);o.start();g.gain.setValueAtTime(.2,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(.001,audioCtx.currentTime+d);o.stop(audioCtx.currentTime+d)}

function fighter(x){return{x,y:groundY,vy:0,hp:100,onGround:true,punch:false}}
let p1=fighter(90),p2=fighter(270);

function hitEffect(x,y){effects.push({x,y,r:5,life:10})}

function update(p,e,ctrl){
 if(ctrl.L)p.x-=3;if(ctrl.R)p.x+=3;
 if(ctrl.J&&p.onGround){p.vy=-12;p.onGround=false;beep(300,.05)}
 p.vy+=gravity;p.y+=p.vy;
 if(p.y>=groundY){p.y=groundY;p.vy=0;p.onGround=true}
 if(ctrl.P&&!p.punch){p.punch=true;beep(600,.07);setTimeout(()=>p.punch=false,180);
  if(Math.abs(p.x-e.x)<40){e.hp=Math.max(0,e.hp-10);beep(180,.1);hitEffect(e.x,e.y-30)}
 }
 p.x=Math.max(20,Math.min(canvas.width-20,p.x));
}

function draw(p){ctx.strokeStyle='#000';ctx.lineWidth=4;
 ctx.beginPath();ctx.arc(p.x,p.y-50,10,0,Math.PI*2);ctx.stroke();
 ctx.beginPath();ctx.moveTo(p.x,p.y-40);ctx.lineTo(p.x,p.y-10);ctx.stroke();
 ctx.beginPath();ctx.moveTo(p.x,p.y-10);ctx.lineTo(p.x-10,p.y+15);ctx.moveTo(p.x,p.y-10);ctx.lineTo(p.x+10,p.y+15);ctx.stroke();
 ctx.beginPath();ctx.moveTo(p.x,p.y-30);ctx.lineTo(p.x+(p.punch?25:15),p.y-25);ctx.stroke();}

function drawHP(p,x){ctx.fillStyle='#ccc';ctx.fillRect(x,10,100,8);ctx.fillStyle='#4caf50';ctx.fillRect(x,10,p.hp,8)}

function drawEffects(){effects.forEach(e=>{ctx.strokeStyle='orange';ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.stroke();e.r+=2;e.life--});effects=effects.filter(e=>e.life>0)}

function loop(){ctx.clearRect(0,0,canvas.width,canvas.height);
 update(p1,p2,{L:keys.aL,R:keys.aR,J:keys.aJ,P:keys.aP});
 update(p2,p1,{L:keys.bL,R:keys.bR,J:keys.bJ,P:keys.bP});
 draw(p1);draw(p2);drawEffects();drawHP(p1,10);drawHP(p2,canvas.width-110);
 if(p1.hp===0||p2.hp===0){ctx.fillStyle='red';ctx.font='24px system-ui';ctx.textAlign='center';ctx.fillText(p1.hp===0?'右方獲勝':'左方獲勝',canvas.width/2,canvas.height/2);return}
 requestAnimationFrame(loop)}
loop();
</script>
</body>
</html>
