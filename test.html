<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>火柴人對決</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #111;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }
    canvas {
      background: #f5f5f5;
      border-radius: 12px;
    }
    .hint {
      position: absolute;
      bottom: 16px;
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="400"></canvas>
  <div class="hint">玩家1：A/D 移動，W 出拳 ｜ 玩家2：←/→ 移動，↑ 出拳</div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const groundY = 320;

    function createFighter(x, color, controls) {
      return {
        x,
        y: groundY,
        hp: 100,
        punching: false,
        color,
        controls
      };
    }

    const p1 = createFighter(200, '#000', { left: 'a', right: 'd', punch: 'w' });
    const p2 = createFighter(600, '#000', { left: 'ArrowLeft', right: 'ArrowRight', punch: 'ArrowUp' });

    const keys = {};
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => keys[e.key] = false);

    function update(player, enemy) {
      if (keys[player.controls.left]) player.x -= 4;
      if (keys[player.controls.right]) player.x += 4;

      if (keys[player.controls.punch] && !player.punching) {
        player.punching = true;
        setTimeout(() => player.punching = false, 200);

        // 簡單命中判定
        if (Math.abs(player.x - enemy.x) < 50) {
          enemy.hp = Math.max(0, enemy.hp - 10);
        }
      }

      player.x = Math.max(50, Math.min(canvas.width - 50, player.x));
    }

    function drawStickman(p) {
      ctx.strokeStyle = p.color;
      ctx.lineWidth = 4;

      // 頭
      ctx.beginPath();
      ctx.arc(p.x, p.y - 60, 12, 0, Math.PI * 2);
      ctx.stroke();

      // 身體
      ctx.beginPath();
      ctx.moveTo(p.x, p.y - 48);
      ctx.lineTo(p.x, p.y - 10);
      ctx.stroke();

      // 腿
      ctx.beginPath();
      ctx.moveTo(p.x, p.y - 10);
      ctx.lineTo(p.x - 12, p.y + 20);
      ctx.moveTo(p.x, p.y - 10);
      ctx.lineTo(p.x + 12, p.y + 20);
      ctx.stroke();

      // 手
      ctx.beginPath();
      if (p.punching) {
        ctx.moveTo(p.x, p.y - 40);
        ctx.lineTo(p.x + 30, p.y - 40);
      } else {
        ctx.moveTo(p.x, p.y - 40);
        ctx.lineTo(p.x - 20, p.y - 30);
        ctx.moveTo(p.x, p.y - 40);
        ctx.lineTo(p.x + 20, p.y - 30);
      }
      ctx.stroke();
    }

    function drawHP(p, x) {
      ctx.fillStyle = '#ccc';
      ctx.fillRect(x, 20, 100, 10);
      ctx.fillStyle = '#4caf50';
      ctx.fillRect(x, 20, p.hp, 10);
    }

    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 地面
      ctx.strokeStyle = '#999';
      ctx.beginPath();
      ctx.moveTo(0, groundY + 20);
      ctx.lineTo(canvas.width, groundY + 20);
      ctx.stroke();

      update(p1, p2);
      update(p2, p1);

      drawStickman(p1);
      drawStickman(p2);

      drawHP(p1, 50);
      drawHP(p2, canvas.width - 150);

      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>

