<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ç«æŸ´äººå°æ±º</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
}
body{
  display:flex;
  justify-content:center;
  align-items:center;
  background:#111;
  color:#fff;
  font-family:system-ui;
}
#app{
  width:360px;
  max-width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
}
canvas{
  background:#f5f5f5;
  border-radius:12px;
  margin:10px 0;
}
button{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  font-size:14px;
}
.menu,.end{
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:center;
}
#mobileControls{
  display:none;
  width:100%;
  justify-content:space-between;
}
@media (orientation: landscape){
  #mobileControls{display:flex}
}
.key{
  border:1px solid #555;
  padding:2px 6px;
  border-radius:6px;
  margin:0 2px;
}
</style>
</head>

<body>
<div id="app">

<!-- é¸å–® -->
<div id="menu" class="menu">
  <h2>ç«æŸ´äººå°æ±º</h2>
  <div>ç©å®¶1 <input id="n1" value="ç©å®¶1"> <input type="color" id="c1" value="#000000"></div>
  <div>ç©å®¶2 <input id="n2" value="ç©å®¶2"> <input type="color" id="c2" value="#ff0000"></div>
  <button onclick="start()">é–‹å§‹éŠæˆ²</button>
</div>

<!-- éŠæˆ² -->
<canvas id="game" width="360" height="400" style="display:none"></canvas>

<!-- æ‰‹æ©Ÿé›™äººæ§åˆ¶ï¼ˆå…©é‚Šä¸€æ¨£ï¼‰ -->
<div id="mobileControls">
  <div>
    <button ontouchstart="m1L=1" ontouchend="m1L=0">â—€</button>
    <button ontouchstart="m1R=1" ontouchend="m1R=0">â–¶</button>
    <button ontouchstart="m1J=1" ontouchend="m1J=0">è·³</button>
    <button ontouchstart="m1P=1" ontouchend="m1P=0">ğŸ‘Š</button>
  </div>
  <div>
    <button ontouchstart="m2L=1" ontouchend="m2L=0">â—€</button>
    <button ontouchstart="m2R=1" ontouchend="m2R=0">â–¶</button>
    <button ontouchstart="m2J=1" ontouchend="m2J=0">è·³</button>
    <button ontouchstart="m2P=1" ontouchend="m2P=0">ğŸ‘Š</button>
  </div>
</div>

<!-- æ“ä½œèªªæ˜ï¼ˆåªä¸€çµ„ï¼‰ -->
<div style="font-size:12px;margin-top:6px">
  ğŸ§ é›»è…¦ï¼šP1 <span class="key">A</span><span class="key">D</span><span class="key">W</span><span class="key">F</span>
  ï½œ P2 <span class="key">â†</span><span class="key">â†’</span><span class="key">â†‘</span><span class="key">/</span><br>
  ğŸ“± æ‰‹æ©Ÿï¼šå·¦å³ç§»å‹•ãƒ»è·³èºãƒ»å‡ºæ‹³ï¼ˆé›™äººåŒæ©Ÿï¼‰
</div>

<!-- çµæŸ -->
<div id="end" class="end" style="display:none">
  <h2 id="win"></h2>
  <button onclick="restart()">å†ä¾†ä¸€å ´</button>
  <button onclick="back()">å›è¨­å®š</button>
</div>

</div>

<script>
const c=document.getElementById('game'),ctx=c.getContext('2d');
const ground=300,grav=0.8;
let key={},m1L=0,m1R=0,m1J=0,m1P=0,m2L=0,m2R=0,m2J=0,m2P=0;
window.onkeydown=e=>key[e.key]=1;
window.onkeyup=e=>key[e.key]=0;

function fighter(x,n,col){
  return{x,y:ground,vy:0,hp:100,name:n,color:col,punch:0,onGround:1}
}
let p1,p2,over=0;

function start(){
  p1=fighter(90,n1.value,c1.value);
  p2=fighter(270,n2.value,c2.value);
  menu.style.display='none';
  c.style.display='block';
  over=0;
  loop();
}
function restart(){
  p1.hp=p2.hp=100;
  end.style.display='none';
  c.style.display='block';
  over=0;
  loop();
}
function back(){
  end.style.display='none';
  c.style.display='none';
  menu.style.display='flex';
}

function update(p,e,L,R,J,P){
  if(L)p.x-=3;
  if(R)p.x+=3;
  if(J&&p.onGround){p.vy=-12;p.onGround=0}
  p.vy+=grav;
  p.y+=p.vy;
  if(p.y>=ground){p.y=ground;p.vy=0;p.onGround=1}
  if(P&&!p.punch){
    p.punch=1;
    setTimeout(()=>p.punch=0,200);
    if(Math.abs(p.x-e.x)<40)e.hp-=10;
  }
}

function drawHP(){
  ctx.fillStyle='red';
  ctx.fillRect(10,10,p1.hp*1.2,8);
  ctx.fillRect(360-10-p2.hp*1.2,10,p2.hp*1.2,8);
}

function drawFighter(p){
  ctx.strokeStyle=p.color;
  ctx.lineWidth=4;

  // é ­
  ctx.beginPath();
  ctx.arc(p.x,p.y-50,10,0,Math.PI*2);
  ctx.stroke();

  // èº«é«”
  ctx.beginPath();
  ctx.moveTo(p.x,p.y-40);
  ctx.lineTo(p.x,p.y-15);
  ctx.stroke();

  // æ‰‹
  ctx.beginPath();
  ctx.moveTo(p.x,p.y-30);
  ctx.lineTo(p.x+(p.punch?25:15),p.y-25);
  ctx.stroke();

  // è…³ï¼ˆè£œå›ä¾†çš„ï¼‰
  ctx.beginPath();
  ctx.moveTo(p.x,p.y-15);
  ctx.lineTo(p.x-10,p.y);
  ctx.moveTo(p.x,p.y-15);
  ctx.lineTo(p.x+10,p.y);
  ctx.stroke();
}

function loop(){
  if(over)return;
  ctx.clearRect(0,0,360,400);
  drawHP();
  update(p1,p2,key.a||m1L,key.d||m1R,key.w||m1J,key.f||m1P);
  update(p2,p1,key.ArrowLeft||m2L,key.ArrowRight||m2R,key.ArrowUp||m2J,key['/']||m2P);
  drawFighter(p1);
  drawFighter(p2);
  if(p1.hp<=0||p2.hp<=0){
    over=1;
    c.style.display='none';
    end.style.display='flex';
    win.innerText=(p1.hp<=0?p2.name:p1.name)+' å‹åˆ©';
    return;
  }
  requestAnimationFrame(loop);
}
</script>
</body>
</html>
