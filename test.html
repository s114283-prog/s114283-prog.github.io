<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ç«æŸ´äººå°æ±º</title>
<link rel="icon" href="images.jpg">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{margin:0;width:100%;height:100%}
body{
  display:flex;justify-content:center;align-items:center;
  background:#111;color:#fff;font-family:system-ui
}
#app{width:360px;text-align:center}
canvas{background:#f5f5f5;border-radius:12px;margin:10px 0}
button,select,input{padding:6px 10px;border-radius:10px;border:none}
.menu,.end{display:flex;flex-direction:column;gap:10px;align-items:center}
.key{border:1px solid #555;padding:2px 6px;border-radius:6px}
.tip{font-size:12px;line-height:1.6}
</style>
</head>

<body>
<div id="app">

<div id="menu" class="menu">
  <h2>ç«æŸ´äººå°æ±º</h2>

  <label><input type="radio" name="mode" value="cpu" checked> å–®äººï¼ˆæ‰“é›»è…¦ï¼‰</label>
  <label><input type="radio" name="mode" value="pvp"> é›™äººå°æˆ°</label>

  <div>
    AI é›£åº¦ï¼š
    <select id="difficulty">
      <option value="easy">ç°¡å–®</option>
      <option value="normal" selected>æ™®é€š</option>
      <option value="hard">å›°é›£</option>
    </select>
  </div>

  <div>ç©å®¶1 <input id="n1" value="ç©å®¶1"> <input type="color" id="c1" value="#000000"></div>
  <div>ç©å®¶2 <input id="n2" value="ç©å®¶2"> <input type="color" id="c2" value="#ff0000"></div>

  <button onclick="start()">é–‹å§‹éŠæˆ²</button>
</div>

<canvas id="game" width="360" height="400" style="display:none"></canvas>

<!-- âœ… æ“ä½œæç¤ºï¼ˆæ¡ˆä»¶æç¤ºï¼‰ -->
<div class="tip">
  ğŸ’» P1ï¼š
  <span class="key">A</span>
  <span class="key">D</span>
  <span class="key">W</span>
  <span class="key">F</span>
  <span class="key">G</span>
  ï½œ P2ï¼š
  <span class="key">â†</span>
  <span class="key">â†’</span>
  <span class="key">â†‘</span>
  <span class="key">/</span>
  <span class="key">.</span><br>
  ğŸ‘Š æ”»æ“Šã€€âš” åˆ‡æ›æ­¦å™¨ã€€ğŸ¦µ è§’è‰²æœƒèµ°è·¯
</div>

<div id="end" class="end" style="display:none">
  <h2 id="win"></h2>
  <button onclick="start()">å†ä¾†ä¸€å ´</button>
  <button onclick="back()">å›è¨­å®š</button>
</div>

</div>

<script>
const c = game, ctx = c.getContext("2d");
const ground = 300, grav = 0.8;
let k = {}, over = false, gameMode = "cpu", aiLevel = "normal";

onkeydown = e => k[e.key] = true;
onkeyup = e => k[e.key] = false;

function fighter(x, name, color){
  return {
    x, y: ground, vy: 0,
    hp: 100,
    name, color,
    weapon: "fist",
    punch: false,
    onGround: true,
    dead: false,
    rot: 0,
    leg: 0
  };
}

let p1, p2, effects = [];

const AI = {
  easy: {speed:2, attack:0.03},
  normal: {speed:3, attack:0.08},
  hard: {speed:4, attack:0.15}
};

function cpuControl(cpu, pl){
  const a = AI[aiLevel];
  let L=0, R=0, P=0;
  const d = pl.x - cpu.x;
  if (Math.abs(d) > 45) d > 0 ? R=1 : L=1;
  if (Math.random() < a.attack) P = 1;
  update(cpu, pl, L, R, 0, P, a.speed);
}

function update(p, e, L, R, J, P, s=3){
  if (p.dead) return;

  if (L) p.x -= s;
  if (R) p.x += s;
  p.x = Math.max(20, Math.min(340, p.x));

  if (J && p.onGround){
    p.vy = -12;
    p.onGround = false;
  }

  p.vy += grav;
  p.y += p.vy;
  if (p.y >= ground){
    p.y = ground;
    p.vy = 0;
    p.onGround = true;
  }

  if (L || R) p.leg += 0.2;
  else p.leg = 0;

  if ((p === p1 && k.g) || (p === p2 && k["."])){
    if (!p._sw){
      p.weapon = p.weapon === "fist" ? "sword" : "fist";
      p._sw = true;
      setTimeout(()=>p._sw=false,300);
    }
  }

  if (P && !p.punch){
    p.punch = true;
    const dmg = p.weapon === "sword" ? 18 : 10;
    const reach = p.weapon === "sword" ? 60 : 40;
    const dx = e.x - p.x;
    const dy = Math.abs((e.y-30)-(p.y-30));
    const facing = (p === p1) ? dx > 0 : dx < 0;

    if (Math.abs(dx) < reach && dy < 35 && facing){
      e.hp = Math.max(0, e.hp - dmg);
      for (let i=0;i<8;i++){
        effects.push({
          x:e.x, y:e.y-30,
          vx:(Math.random()-0.5)*4,
          vy:-Math.random()*4,
          l:20
        });
      }
    }
    setTimeout(()=>p.punch=false,250);
  }
}

function drawF(p){
  ctx.save();
  ctx.translate(p.x, p.y-20);
  ctx.rotate(p.rot);
  ctx.strokeStyle = p.color;
  ctx.lineWidth = 4;

  ctx.beginPath(); ctx.arc(0,-30,10,0,7); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(0,-20); ctx.lineTo(0,10); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(0,-10); ctx.lineTo(-20,0); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(0,-10); ctx.lineTo(20,0); ctx.stroke();

  if (p.weapon==="sword"){
    ctx.beginPath(); ctx.moveTo(20,0); ctx.lineTo(40,-10); ctx.stroke();
  }

  const a = Math.sin(p.leg)*8;
  ctx.beginPath();
  ctx.moveTo(0,10); ctx.lineTo(-10+a,30);
  ctx.moveTo(0,10); ctx.lineTo(10-a,30);
  ctx.stroke();

  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,360,400);
  ctx.fillStyle="red";
  ctx.fillRect(10,10,p1.hp*1.2,8);
  ctx.fillRect(360-10-p2.hp*1.2,10,p2.hp*1.2,8);

  drawF(p1); drawF(p2);

  effects.forEach(e=>{
    ctx.fillStyle="red";
    ctx.fillRect(e.x,e.y,3,3);
    e.x+=e.vx; e.y+=e.vy; e.vy+=0.3; e.l--;
  });
  effects = effects.filter(e=>e.l>0);
}

function loop(){
  if (over) return;

  if (gameMode==="cpu") cpuControl(p2,p1);
  update(p1,p2,k.a,k.d,k.w,k.f);
  if (gameMode==="pvp")
    update(p2,p1,k.ArrowLeft,k.ArrowRight,k.ArrowUp,k["/"]);

  draw();

  if (p1.hp<=0 || p2.hp<=0){
    over=true;
    game.style.display="none";
    end.style.display="flex";
    win.innerText = (p1.hp<=0?p2.name:p1.name)+" å‹åˆ©";
  }
  requestAnimationFrame(loop);
}

function start(){
  gameMode=document.querySelector('[name=mode]:checked').value;
  aiLevel=difficulty.value;
  p1=fighter(90,n1.value,c1.value);
  p2=fighter(270,n2.value,c2.value);
  menu.style.display="none";
  game.style.display="block";
  over=false;
  loop();
}

function back(){
  end.style.display="none";
  menu.style.display="flex";
}
</script>
</body>
</html>

