<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ç«æŸ´äººå°æ±º</title>
<link rel="icon" href="images.jpg">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{margin:0;width:100%;height:100%}
body{
  display:flex;justify-content:center;align-items:center;
  background:#111;color:#fff;font-family:system-ui
}
#app{width:360px;text-align:center}
canvas{background:#f5f5f5;border-radius:12px;margin:10px 0}
button,select,input{padding:6px 10px;border-radius:10px;border:none}
.menu,.end{display:flex;flex-direction:column;gap:10px;align-items:center}
.key{
  display:inline-block;
  min-width:22px;
  padding:2px 6px;
  margin:2px;
  border-radius:6px;
  background:#222;
  border:1px solid #666;
  font-size:12px;
}
</style>
</head>

<body>
<div id="app">

<div id="menu" class="menu">
<h2>ç«æŸ´äººå°æ±º</h2>

<label><input type="radio" name="mode" value="cpu" checked> å–®äººï¼ˆæ‰“é›»è…¦ï¼‰</label>
<label><input type="radio" name="mode" value="pvp"> é›™äººå°æˆ°</label>

<div>
AI é›£åº¦ï¼š
<select id="difficulty">
<option value="easy">ç°¡å–®</option>
<option value="normal" selected>æ™®é€š</option>
<option value="hard">å›°é›£</option>
</select>
</div>

<div>ç©å®¶1 <input id="n1" value="ç©å®¶1"> <input type="color" id="c1" value="#000000"></div>
<div>ç©å®¶2 <input id="n2" value="ç©å®¶2"> <input type="color" id="c2" value="#ff0000"></div>

<button onclick="start()">é–‹å§‹éŠæˆ²</button>
</div>

<canvas id="game" width="360" height="400" style="display:none"></canvas>

<div style="font-size:12px">
ğŸ’» P1
<span class="key">A</span><span class="key">D</span><span class="key">W</span>
<span class="key">F</span><span class="key">G</span>
ï½œ
P2
<span class="key">â†</span><span class="key">â†’</span><span class="key">â†‘</span>
<span class="key">/</span><span class="key">.</span>
</div>

<div id="end" class="end" style="display:none">
<h2 id="win"></h2>
<button onclick="start()">å†ä¾†ä¸€å ´</button>
<button onclick="back()">å›è¨­å®š</button>
</div>

</div>

<script>
const c=document.getElementById("game");
const ctx=c.getContext("2d");
const ground=300,grav=0.8;

const keys={};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

const AudioCtx=new (window.AudioContext||webkitAudioContext)();
function beep(f){
  const o=AudioCtx.createOscillator(),g=AudioCtx.createGain();
  o.connect(g);g.connect(AudioCtx.destination);
  o.frequency.value=f;g.gain.value=0.15;
  o.start();o.stop(AudioCtx.currentTime+0.08);
}

function fighter(x,name,color){
  return{
    x,y:ground,vy:0,
    hp:100,weapon:"fist",
    name,color,
    punch:false,onGround:true,
    leg:0,dead:false
  }
}

let p1,p2,effects=[],over=false,mode="cpu",aiLv="normal";

const AI={
  easy:{speed:2,rate:0.03},
  normal:{speed:3,rate:0.08},
  hard:{speed:4,rate:0.15}
};

function attack(p,e){
  if(p.punch||p.dead)return;
  p.punch=true;beep(200);
  const range=p.weapon==="sword"?65:45;
  const dmg=p.weapon==="sword"?18:10;
  if(Math.abs(p.x-e.x)<range){
    e.hp=Math.max(0,e.hp-dmg);
    for(let i=0;i<8;i++){
      effects.push({
        x:e.x,y:e.y-30,
        vx:(Math.random()-0.5)*4,
        vy:-Math.random()*4,l:20
      });
    }
  }
  setTimeout(()=>p.punch=false,220);
}

function update(p,e,L,R,J,P){
  if(p.dead)return;
  if(L)p.x-=3;
  if(R)p.x+=3;
  p.x=Math.max(20,Math.min(340,p.x));

  if(J&&p.onGround){p.vy=-12;p.onGround=false}
  p.vy+=grav;p.y+=p.vy;
  if(p.y>=ground){p.y=ground;p.vy=0;p.onGround=true}

  p.leg+=Math.abs(p.vy)<1&&(L||R)?0.2:0;

  if(P)attack(p,e);
}

function cpu(cpu,pl){
  const a=AI[aiLv];
  let L=0,R=0,P=0;
  const d=pl.x-cpu.x;
  if(Math.abs(d)>50)d>0?R=1:L=1;
  if(Math.random()<a.rate)P=1;
  update(cpu,pl,L,R,0,P);
}

function drawF(p){
  ctx.save();
  ctx.translate(p.x,p.y-20);
  ctx.strokeStyle=p.color;ctx.lineWidth=4;

  ctx.beginPath();ctx.arc(0,-30,10,0,7);ctx.stroke();
  ctx.beginPath();ctx.moveTo(0,-20);ctx.lineTo(0,10);ctx.stroke();

  ctx.beginPath();ctx.moveTo(0,-10);ctx.lineTo(-20,-5);ctx.stroke();
  ctx.beginPath();ctx.moveTo(0,-10);ctx.lineTo(20,-5);ctx.stroke();

  if(p.weapon==="sword"){
    ctx.beginPath();ctx.moveTo(20,-5);ctx.lineTo(45,-10);ctx.stroke();
  }

  ctx.beginPath();
  ctx.moveTo(0,10);
  ctx.lineTo(-10,25+Math.sin(p.leg)*5);
  ctx.moveTo(0,10);
  ctx.lineTo(10,25-Math.sin(p.leg)*5);
  ctx.stroke();

  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,360,400);

  ctx.fillStyle="red";
  ctx.fillRect(10,10,p1.hp*1.2,8);
  ctx.fillRect(360-10-p2.hp*1.2,10,p2.hp*1.2,8);

  drawF(p1);drawF(p2);

  effects.forEach(e=>{
    ctx.fillStyle="red";
    ctx.fillRect(e.x,e.y,3,3);
    e.x+=e.vx;e.y+=e.vy;e.vy+=0.3;e.l--;
  });
  effects=effects.filter(e=>e.l>0);
}

function loop(){
  if(over)return;
  if(mode==="cpu")cpu(p2,p1);

  update(p1,p2,keys.a,keys.d,keys.w,keys.f);
  if(keys.g&&p1.onGround){p1.weapon=p1.weapon==="fist"?"sword":"fist";beep(120)}

  if(mode==="pvp"){
    update(p2,p1,keys.ArrowLeft,keys.ArrowRight,keys.ArrowUp,keys["/"]);
    if(keys["."]&&p2.onGround){p2.weapon=p2.weapon==="fist"?"sword":"fist";beep(120)}
  }

  draw();

  if(p1.hp<=0||p2.hp<=0){
    over=true;
    game.style.display="none";
    end.style.display="flex";
    win.innerText=(p1.hp<=0?p2.name:p1.name)+" å‹åˆ©";
  }
  requestAnimationFrame(loop);
}

function start(){
  mode=document.querySelector("[name=mode]:checked").value;
  aiLv=difficulty.value;
  p1=fighter(90,n1.value,c1.value);
  p2=fighter(270,n2.value,c2.value);
  menu.style.display="none";
  game.style.display="block";
  over=false;
  loop();
}

function back(){
  end.style.display="none";
  menu.style.display="flex";
}
</script>
</body>
</html>


